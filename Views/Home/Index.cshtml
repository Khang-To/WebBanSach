@{
    ViewData["Title"] = "TKBook - Nhà sách trực tuyến uy tín";
    var bestSellers = ViewBag.BestSellers as List<Product> ?? new List<Product>();
    var categories = ViewBag.Categories as List<ProductCategory> ?? new List<ProductCategory>();
    var newBooks = ViewBag.NewBooks as List<Product> ?? new List<Product>();
    var discountBooks = ViewBag.DiscountBooks as List<Product> ?? new List<Product>();
}

<style>
    /* ================= GLOBAL CSS CHO SẢN PHẨM ================= */

    /* 1. Card sản phẩm dùng chung */
    .product-card {
        background: #fff;
        border: 1px solid #f0f0f0;
        transition: all 0.3s ease;
        position: relative;
        width: 100%;
        height: 100%; /* Đảm bảo card cao bằng nhau */
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
        border-color: #1abc9c;
    }

    .product-card img {
        height: 220px;
        width: auto;
        max-width: 100%;
        object-fit: contain;
        margin: 0 auto;
        padding-top: 15px;
        display: block; /* Canh giữa ảnh tốt hơn */
    }

    /* 2. Nút điều hướng Carousel */
    .carousel-control-custom {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: white !important;
        color: #333 !important;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        opacity: 1;
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
        border: 1px solid #eee;
        outline: none !important;
        transition: all 0.3s;
    }

    .carousel-control-custom:hover {
       background-color: #1abc9c !important;
       color: white !important;
       border-color: #1abc9c;
    }

    .carousel-control-prev.carousel-control-custom {
        left: -20px;
    }

    .carousel-control-next.carousel-control-custom {
        right: -20px;
    }

    /* 3. Tiêu đề section */
    .section-header {
        border-left: 5px solid;
        padding-left: 15px;
    }

    .hover-shadow {
        transition: all 0.3s ease;
    }

    .hover-shadow:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.1) !important;
    }

    /* ================= RIÊNG CHO BANNER CHÍNH (Đã fix) ================= */
    /* Chỉ định rõ ID #homeCarousel để không ảnh hưởng các slider dưới */
    #homeCarousel .carousel-item {
        padding: 0;
        height: 450px;
        background: linear-gradient(135deg, #e8f5e8, #d0e8f5);
    }

    #homeCarousel .carousel-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
</style>

<!-- Carousel -->
<div id="homeCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="~/images/carousel/ribbon1.jpg" class="d-block w-100" alt="">
        </div>
        <div class="carousel-item">
            <img src="~/images/carousel/ribbon2.jpg" class="d-block w-100" alt="">
        </div>
        <div class="carousel-item">
            <img src="~/images/carousel/ribbon3.jpg" class="d-block w-100" alt="">
        </div>
        <div class="carousel-item">
            <img src="~/images/carousel/ribbon4.jpg" class="d-block w-100" alt="">
        </div>
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#homeCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#homeCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>

<!-- Danh mục nổi bật -->
<section class="mb-5 py-5">
    <h2 class="text-center mb-5 fw-bold text-success">DANH MỤC NỔI BẬT</h2>
    <div class="row g-4 justify-content-center">
        @foreach (var cat in categories)
        {
            <div class="col-lg-2 col-md-3 col-6">
                <a asp-controller="Products" asp-action="Index" asp-route-categoryId="@cat.ID" class="text-decoration-none d-block h-100">
                    <div class="text-center p-4 bg-white rounded-3 shadow-sm hover-shadow transition h-100 d-flex flex-column justify-content-center">
                        <div class="bg-light rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 90px; height: 90px; flex-shrink: 0;">
                            <i class="bi bi-book fs-2 text-success"></i>
                        </div>
                        <h6 class="fw-bold text-dark mb-1 px-2" style="min-height: 52px; display: flex; align-items: center; justify-content: center;">
                            @cat.Name
                        </h6>
                    </div>
                </a>
            </div>
        }
    </div>
</section>

<!-- Danh mục sách bán chạy -->
<section class="mb-5 py-5 bg-light">
    <div class="container position-relative">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold text-dark section-header border-success">TOP SÁCH BÁN CHẠY</h4>
            <a asp-controller="Products" asp-action="Index"
               class="btn btn-outline-success btn-sm fw-semibold me-3">
                Xem tất cả <i class="bi bi-chevron-right"></i>
            </a>
        </div>

        <div id="carouselBestSellers" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">

            <div class="carousel-inner p-3">
                @{
                    // Lấy dữ liệu
                    int itemsPerSlide = 4;
                    int totalSlidesBS = (int)Math.Ceiling((double)bestSellers.Count() / itemsPerSlide);
                }

                @for (int i = 0; i < totalSlidesBS; i++)
                {
                    <div class="carousel-item @(i == 0 ? "active" : "")">
                        <div class="row justify-content-start g-3 ms-1 me-1">
                            @foreach (var item in bestSellers.Skip(i * itemsPerSlide).Take(itemsPerSlide))
                            {
                                <div class="col-6 col-md-3 d-flex justify-content-center">
                                    <partial name="_ProductCard" model="item" />
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <button class="carousel-control-prev carousel-control-custom" type="button" data-bs-target="#carouselBestSellers" data-bs-slide="prev">
                <i class="bi bi-chevron-left"></i>
            </button>
            <button class="carousel-control-next carousel-control-custom" type="button" data-bs-target="#carouselBestSellers" data-bs-slide="next">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>
    </div>
</section>

<!-- Danh mục sách mới -->
<section class="mb-5 py-5 bg-light">
    <div class="container position-relative">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold text-dark section-header border-info">Sách mới</h4>
            <a asp-controller="Products" asp-action="Index"
               class="btn btn-outline-success btn-sm fw-semibold me-3">
                Xem tất cả <i class="bi bi-chevron-right"></i>
            </a>
        </div>

        <div id="carouselNewBooks" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">

            <div class="carousel-inner p-3">
                @{
                    // Lấy dữ liệu
                    int itemsPerSlideNB = 4;
                    int totalSlidesNB = (int)Math.Ceiling((double)newBooks.Count() / itemsPerSlideNB);
                }

                @for (int i = 0; i < totalSlidesNB; i++)
                {
                    <div class="carousel-item @(i == 0 ? "active" : "")">
                        <div class="row justify-content-start g-3 ms-1 me-1">
                            @foreach (var item in newBooks.Skip(i * itemsPerSlideNB).Take(itemsPerSlideNB))
                            {
                                <div class="col-6 col-md-3 d-flex justify-content-center">
                                    <partial name="_ProductCard" model="item" />
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <button class="carousel-control-prev carousel-control-custom" type="button" data-bs-target="#carouselNewBooks" data-bs-slide="prev">
                <i class="bi bi-chevron-left"></i>
            </button>
            <button class="carousel-control-next carousel-control-custom" type="button" data-bs-target="#carouselNewBooks" data-bs-slide="next">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>
    </div>
</section>

<!-- Danh mục sách đang giảm giá -->
<section class="mb-5 py-5 bg-light">
    <div class="container position-relative">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold text-dark section-header border-danger">Sách giảm giá</h4>
            <a asp-controller="Products" asp-action="Index"
               class="btn btn-outline-success btn-sm fw-semibold me-3">
                Xem tất cả <i class="bi bi-chevron-right"></i>
            </a>
        </div>

        <div id="carouselDiscountBooks" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">

            <div class="carousel-inner p-3">
                @{
                    // Lấy dữ liệu
                    int itemsPerSlideDB = 4;
                    int totalSlidesDB = (int)Math.Ceiling((double)discountBooks.Count() / itemsPerSlideDB);
                }

                @for (int i = 0; i < totalSlidesDB; i++)
                {
                    <div class="carousel-item @(i == 0 ? "active" : "")">
                        <div class="row justify-content-start g-3 ms-1 me-1">
                            @foreach (var item in discountBooks.Skip(i * itemsPerSlideDB).Take(itemsPerSlideDB))
                            {
                                <div class="col-6 col-md-3 d-flex justify-content-center">
                                    <partial name="_ProductCard" model="item" />
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <button class="carousel-control-prev carousel-control-custom" type="button" data-bs-target="#carouselDiscountBooks" data-bs-slide="prev">
                <i class="bi bi-chevron-left"></i>
            </button>
            <button class="carousel-control-next carousel-control-custom" type="button" data-bs-target="#carouselDiscountBooks" data-bs-slide="next">
                <i class="bi bi-chevron-right"></i>
            </button>
        </div>
    </div>
</section>
