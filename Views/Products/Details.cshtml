@model WebBanSach.Models.Product

@{
    ViewData["Title"] = "Details";
    var related = ViewBag.RelatedBooks as List<Product> ?? new List<Product>();
}

<style>
    /* Giãn cách các dòng thông tin */
    .book-info p {
        margin-bottom: 10px;
        font-size: 16px;
    }

    /* Bỏ nút tăng giảm mặc định của input number */
    .qty-input::-webkit-outer-spin-button,
    .qty-input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    .qty-input[type=number] {
        -moz-appearance: textfield; /* Firefox */
    }

    /* Ô số lượng đẹp hơn */
    .qty-box {
        width: 140px;
        display: flex;
        align-items: center;
        border: 1px solid #ccc;
        border-radius: 6px;
        overflow: hidden;
    }

    .qty-btn {
        width: 45px;
        height: 45px;
        border: none;
        font-size: 22px;
        background: #f4f4f4;
        cursor: pointer;
    }

    .qty-input {
        width: 50px;
        height: 45px;
        border: none;
        text-align: center;
        font-size: 18px;

    }

    .product-image {
        width: 100%;
        height: 420px; 
        object-fit: contain; 
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }


    /* Nút thêm vào giỏ */
    .btn-addcart {
        margin-top: 20px;
        width: 240px;
        height: 48px;
        font-size: 17px;
        font-weight: 600;
    }

    .product-card {
        background: #fff;
        border: 1px solid #f0f0f0;
        transition: all 0.3s ease;
        position: relative;
        width: 100%;
        height: 100%; /* Đảm bảo card cao bằng nhau */
    }

    .product-card img {
        height: 220px;
        width: auto;
        max-width: 100%;
        object-fit: contain;
        margin: 0 auto;
        padding-top: 15px;
        display: block; /* Canh giữa ảnh tốt hơn */
    }

    .carousel-control-custom {
        width: 50px;
        height: 50px;
        top: 40%;
        background: white;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        display: flex !important;
        align-items: center;
        justify-content: center;
    }

    .carousel-control-custom i {
        font-size: 32px;
        color: #198754; /* xanh Bootstrap */
    }

    .carousel-control-prev {
        left: -25px;
    }

    .carousel-control-next {
        right: -25px;
    }

</style>

<div class="container mt-4">

    <!-- ================== ROW 1 – CHI TIẾT SÁCH ================== -->
    <div class="row g-4">

        <!-- Ảnh sách -->
        <div class="col-md-5">
            <img src="~/images/products/@Model.ImageUrl" class="product-image" />
        </div>

        <!-- Thông tin -->
        <div class="col-md-7 ps-5">
            <h3 class="fw-bold mb-3">@Model.Name</h3>

            <div class="book-info">
                <p><b>Tác giả:</b> @Model.Author?.Name</p>
                <p><b>Thể loại:</b> @Model.Category?.Name</p>
                <p><b>Nhà xuất bản:</b> @Model.Publisher?.Name</p>

                <p>
                    <b>Năm xuất bản:</b> @Model.PublishYear
                </p>

                <p>
                    <b>Số trang:</b> @Model.TotalPage
                </p>

                <p>
                    <b>Tồn kho:</b> @Model.Stock
                </p>
            </div>

            @if (Model.DiscountPercent > 0)
            {
                <p class="text-muted text-decoration-line-through m-0">
                    @Model.Price.ToString("n0") đ
                </p>
            }

            <h3 class="text-danger fw-bold mt-2">
                @Model.FinalPrice.ToString("n0") đ
            </h3>

            <!-- Bộ tăng giảm số lượng -->
            <div class="mt-3">
                <label class="fw-bold mb-2">Số lượng</label>
                <div class="qty-box">
                    <button class="qty-btn" onclick="minusQty()">-</button>
                    <input id="qtyInput" type="number" value="1" min="1" class="qty-input" readonly/>
                    <button class="qty-btn" onclick="plusQty()">+</button>
                </div>
            </div>

            <!-- Nút thêm vào giỏ -->
            <button class="btn btn-success btn-addcart" onclick="addToCart(@Model.ID)">
                <i class="bi bi-cart-plus"></i> &nbsp;Thêm vào giỏ hàng
            </button>
        </div>
</div>

    <hr class="my-5" />

    <!-- ================== ROW 2 – MÔ TẢ ================== -->
    <div class="row">
        <div class="col-12">
            <h4 class="fw-bold">MÔ TẢ SÁCH</h4>
            <p class="mt-3">@Model.Description</p>
        </div>
    </div>

    <hr class="my-5" />

    <!-- ================== ROW 3 – SÁCH LIÊN QUAN ================== -->
    <div class="container position-relative mt-5">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold text-dark section-header border-success">SÁCH CÙNG THỂ LOẠI</h4>
            <a asp-controller="Products" asp-action="Index" asp-route-categoryId="@Model.CategoryId" class="text-success fw-semibold text-decoration-none">Xem tất cả</a>
        </div>

        <div id="carouselRelatedBooks" class="carousel slide" data-bs-ride="carousel" data-bs-interval="6000">

            <div class="carousel-inner p-3">
                @{
                    int itemsPerSlideRB = 4;
                    int totalSlidesRB = (int)Math.Ceiling((double)related.Count() / itemsPerSlideRB);
                }

                @for (int i = 0; i < totalSlidesRB; i++)
                {
                    <div class="carousel-item @(i == 0 ? "active" : "")">
                        <div class="row justify-content-start g-3 ms-1 me-1">
                            @foreach (var item in related.Skip(i * itemsPerSlideRB).Take(itemsPerSlideRB))
                            {
                                <div class="col-6 col-md-3 d-flex justify-content-center">
                                    <partial name="_ProductCard" model="item" />
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <button class="carousel-control-prev carousel-control-custom" type="button"
                    data-bs-target="#carouselRelatedBooks" data-bs-slide="prev">
                <i class="bi bi-chevron-left"></i>
            </button>

            <button class="carousel-control-next carousel-control-custom" type="button"
                    data-bs-target="#carouselRelatedBooks" data-bs-slide="next">
                <i class="bi bi-chevron-right"></i>
            </button>

        </div>
    </div>

</div>

<script>

    function plusQty() {
        let input = document.getElementById("qtyInput");
        input.value = parseInt(input.value) + 1;
    }
    function minusQty() {
        let input = document.getElementById("qtyInput");
        if (parseInt(input.value) > 1) input.value = parseInt(input.value) - 1;
    }

    function addToCart(productId) {
        let qty = document.getElementById("qtyInput").value;

        // TODO: gọi AJAX thêm giỏ hàng nếu bạn muốn
        alert("Đã thêm " + qty + " sản phẩm vào giỏ!");
    }
</script>
