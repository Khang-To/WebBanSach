@model WebBanSach.Models.Order

@{
    ViewData["Title"] = "Chi tiết đơn hàng #" + Model.ID;
}

<h2 class="fw-bold mb-4">Chi tiết đơn hàng #@Model.ID</h2>


<!-- ===================== ROW 1 — THÔNG TIN KHÁCH HÀNG ===================== -->
<div class="mb-4">
    <h4 class="fw-bold mb-3">Thông tin khách hàng</h4>

    <dl class="row">
        <dt class="col-sm-2">Họ tên:</dt>
        <dd class="col-sm-10">@Model.User?.FullName</dd>

        <dt class="col-sm-2">Địa chỉ:</dt>
        <dd class="col-sm-10">@Model.User?.Address</dd>

        <dt class="col-sm-2">Số điện thoại:</dt>
        <dd class="col-sm-10">@Model.User?.PhoneNumber</dd>

        <dt class="col-sm-2">Email:</dt>
        <dd class="col-sm-10">@Model.User?.Email</dd>
    </dl>
</div>


<!-- ===================== ROW 2 — DANH SÁCH SẢN PHẨM ===================== -->
<div class="mb-4">
    <h4 class="fw-bold mb-3">Sản phẩm đặt mua</h4>

    <div class="table-responsive">
        <table class="table table-bordered">
            <thead class="table-light fw-bold">
                <tr class="text-center">
                    <th>Tên sách</th>
                    <th>Thể loại</th>
                    <th>Nhà xuất bản</th>
                    <th>Đơn giá</th>
                    <th>Số lượng</th>
                    <th>Thành tiền</th>
                </tr>
            </thead>
            <tbody>
                @{
                    decimal tong = 0;
                }

                @foreach (var item in Model.OrderDetails)
                {
                    var tt = item.Quantity * item.UnitPrice;
                    tong += tt;

                    <tr>
                        <td>@item.Product?.Name</td>
                        <td>@item.Product?.Category?.Name</td>
                        <td>@item.Product?.Publisher?.Name</td>
                        <td>@item.Quantity</td>
                        <td>@item.UnitPrice.ToString("n0") ₫</td>
                        <td>@tt.ToString("n0") ₫</td>
                    </tr>
                }

                <tr class="fw-bold table-light">
                    <td colspan="5" class="text-end">Tổng cộng:</td>
                    <td class="text-end text-danger">@tong.ToString("N0") đ</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


<!-- ===================== ROW 3 — GHI CHÚ ĐƠN HÀNG ===================== -->
<div class="mb-4">
    <h4 class="fw-bold mb-3">Ghi chú đơn hàng</h4>

    <textarea class="form-control" rows="4" readonly>
@(string.IsNullOrEmpty(Model.Note) ? "Không có ghi chú" : Model.Note)
</textarea>
</div>


<!-- ===================== ACTION BUTTONS ===================== -->
<div class="d-flex gap-3">

    <!-- XÁC NHẬN -->
    <form asp-action="UpdateStatus" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="id" value="@Model.ID" />
        <input type="hidden" name="newStatus" value="Confirmed" />  <!-- Đổi thành newStatus -->
        <button type="submit"
                class="btn btn-success btn-lg text-white"
                @(Model.Status != OrderStatus.Pending ? "disabled" : "")>
            Xác nhận đơn hàng
        </button>
    </form>

    <!-- HỦY -->
    <form asp-action="UpdateStatus" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="id" value="@Model.ID" />
        <input type="hidden" name="newStatus" value="Cancelled" />  <!-- Đổi thành newStatus -->
        <button type="submit"
                class="btn btn-danger btn-lg text-white"
                @(Model.Status == OrderStatus.Paid || Model.Status == OrderStatus.Cancelled ? "disabled" : "")
                onclick="return confirm('Bạn có chắc muốn hủy đơn hàng và hoàn lại tồn kho?')">
            Hủy đơn & hoàn kho
        </button>
    </form>

    <!-- QUAY LẠI -->
    <a asp-action="Index" class="btn btn-secondary btn-lg">
        Quay lại
    </a>

</div>
